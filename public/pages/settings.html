<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ContaComigo - Configurações</title>
    <meta name="description" content="Configure sua conta no ContaComigo.">
    <link rel="icon" type="image/png" href="../assets/logos/logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/globals.css">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/components/sidebar.css">
    <link rel="stylesheet" href="../css/components/header.css">
    <link rel="stylesheet" href="../css/settings.css">
    <link rel="stylesheet" href="../css/modal.css">
</head>
<body>
    <div class="dashboard-container">
        <div id="sidebar-container"></div>
        
        <main class="main-content">
            <div id="header-container"></div>
            
            <div class="page-content">
                <div class="settings-container">
                    <div class="settings-layout">
                        <div class="settings-menu">
                            <nav class="settings-nav">
                                <button class="settings-nav-item active" data-section="personal">
                                    <i class="fas fa-user"></i>
                                    <span>Informações Pessoais</span>
                                </button>
                                <button class="settings-nav-item" data-section="security">
                                    <i class="fas fa-shield-alt"></i>
                                    <span>Segurança</span>
                                </button>
                                <button class="settings-nav-item" data-section="openfinance">
                                    <i class="fas fa-university"></i>
                                    <span>Open Finance</span>
                                </button>
                                <button class="settings-nav-item" data-section="privacy">
                                    <i class="fas fa-user-shield"></i>
                                    <span>Privacidade</span>
                                </button>
                            </nav>
                        </div>

                        <div class="settings-content-wrapper">
                            <div class="settings-section content-section active" id="personal-section">
                                <div class="settings-content">
                                    <div class="section-header">
                                        <h3 class="section-title">
                                            <i class="fas fa-user"></i>
                                            Informações Pessoais
                                        </h3>
                                        <p class="section-subtitle">Gerencie seus dados pessoais</p>
                                    </div>
                                    
                                    <div class="settings-card">
                            <form id="profileForm" class="profile-form">
                                <div class="form-row profile-photo-section">
                                    <div class="form-group profile-photo-group">
                                        <label class="form-label">Foto de Perfil</label>
                                        <div class="profile-photo-container">
                                            <div class="profile-photo-preview" id="profilePhotoPreview">
                                                <i class="fas fa-user"></i>
                                            </div>
                                            <div class="profile-photo-actions">
                                                <input type="file" id="profilePhotoInput" accept="image/*" style="display: none;">
                                                <button type="button" class="btn btn-secondary" id="uploadPhotoBtn">
                                                    <i class="fas fa-camera"></i>
                                                    Alterar Foto
                                                </button>
                                                <button type="button" class="btn btn-outline" id="removePhotoBtn" style="display: none;">
                                                    <i class="fas fa-trash"></i>
                                                    Remover
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="fullName" class="form-label">Nome Completo</label>
                                        <input type="text" id="fullName" name="fullName" class="form-input" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="birthDate" class="form-label">Data de Nascimento</label>
                                        <input type="date" id="birthDate" name="birthDate" class="form-input" required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="email" class="form-label">E-mail</label>
                                        <input type="email" id="email" name="email" class="form-input" readonly>
                                        <small class="form-help">O e-mail não pode ser alterado</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="cpf" class="form-label">CPF</label>
                                        <input type="text" id="cpf" name="cpf" class="form-input" readonly>
                                        <small class="form-help">O CPF não pode ser alterado</small>
                                    </div>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i>
                                        Salvar Alterações
                                    </button>
                                </div>
                            </form>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section content-section" id="security-section">
                                <div class="settings-content">
                                    <div class="section-header">
                                        <h3 class="section-title">
                                            <i class="fas fa-shield-alt"></i>
                                            Segurança
                                        </h3>
                                        <p class="section-subtitle">Altere sua senha e configure a segurança da conta</p>
                                    </div>
                                    
                                    <div class="settings-card">
                                    <form id="passwordForm" class="password-form">
                                <div class="form-group">
                                    <label for="currentPassword" class="form-label">Senha Atual</label>
                                    <div class="password-input">
                                        <input type="password" id="currentPassword" name="currentPassword" class="form-input" required>
                                        <button type="button" class="password-toggle" data-target="currentPassword">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="newPassword" class="form-label">Nova Senha</label>
                                        <div class="password-input">
                                            <input type="password" id="newPassword" name="newPassword" class="form-input" required>
                                            <button type="button" class="password-toggle" data-target="newPassword">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div class="password-strength">
                                            <div class="strength-bar">
                                                <div class="strength-fill"></div>
                                            </div>
                                            <span class="strength-text">Força da senha</span>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="confirmPassword" class="form-label">Confirmar Nova Senha</label>
                                        <div class="password-input">
                                            <input type="password" id="confirmPassword" name="confirmPassword" class="form-input" required>
                                            <button type="button" class="password-toggle" data-target="confirmPassword">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                        <div class="form-actions">
                                             <button type="submit" class="btn btn-primary">
                                                 <i class="fas fa-key"></i>
                                                 Alterar Senha
                                             </button>
                                         </div>
                                     </form>
                                    </div>
                                </div>
                            </div>
                            </div>

                            <div class="settings-section content-section" id="openfinance-section">
                                <div class="settings-content">
                                    <div class="section-header">
                                        <h3 class="section-title">
                                            <i class="fas fa-university"></i>
                                            Open Finance
                                        </h3>
                                        <p class="section-subtitle">Gerencie suas conexões bancárias</p>
                                    </div>
                                    
                                    <div class="settings-card">
                                        <!-- Seção de Vinculação de Múltiplas Contas -->
                                        <div class="multi-connect-section">
                                            <div class="section-header">
                                                <h4 class="section-title">
                                                    <i class="fas fa-plus-circle"></i>
                                                    Vincular Novas Contas
                                                </h4>
                                                <p class="section-subtitle">Selecione uma ou mais instituições para conectar simultaneamente</p>
                                            </div>
                                            
                                            <div class="institutions-grid-settings">
                                                <div class="institution-card-settings" data-bank-id="vitor">
                                                    <div class="institution-selection-checkbox">
                                                        <input type="checkbox" id="bank-vitor" class="bank-checkbox">
                                                        <label for="bank-vitor" class="checkbox-label"></label>
                                                    </div>
                                                    <div class="institution-info">
                                                        <div class="institution-logo vitor">V</div>
                                                        <div class="institution-details">
                                                            <h4>Banco Vitor</h4>
                                                            <p>API Vitor - Investimentos</p>
                                                        </div>
                                                    </div>
                                                    <div class="connection-status" id="status-vitor">
                                                        <span class="status-text">Não conectado</span>
                                                    </div>
                                                </div>
                                                
                                                <div class="institution-card-settings" data-bank-id="lucas">
                                                    <div class="institution-selection-checkbox">
                                                        <input type="checkbox" id="bank-lucas" class="bank-checkbox">
                                                        <label for="bank-lucas" class="checkbox-label"></label>
                                                    </div>
                                                    <div class="institution-info">
                                                        <div class="institution-logo lucas">L</div>
                                                        <div class="institution-details">
                                                            <h4>Banco Lucas</h4>
                                                            <p>API Lucas - Conta Corrente</p>
                                                        </div>
                                                    </div>
                                                    <div class="connection-status" id="status-lucas">
                                                        <span class="status-text">Não conectado</span>
                                                    </div>
                                                </div>
                                                
                                                <div class="institution-card-settings" data-bank-id="patricia">
                                                    <div class="institution-selection-checkbox">
                                                        <input type="checkbox" id="bank-patricia" class="bank-checkbox">
                                                        <label for="bank-patricia" class="checkbox-label"></label>
                                                    </div>
                                                    <div class="institution-info">
                                                        <div class="institution-logo patricia">P</div>
                                                        <div class="institution-details">
                                                            <h4>Banco Patricia</h4>
                                                            <p>API Patricia - Categorias</p>
                                                        </div>
                                                    </div>
                                                    <div class="connection-status" id="status-patricia">
                                                        <span class="status-text">Não conectado</span>
                                                    </div>
                                                </div>
                                                
                                                <div class="institution-card-settings" data-bank-id="dante">
                                                    <div class="institution-selection-checkbox">
                                                        <input type="checkbox" id="bank-dante" class="bank-checkbox">
                                                        <label for="bank-dante" class="checkbox-label"></label>
                                                    </div>
                                                    <div class="institution-info">
                                                        <div class="institution-logo dante">D</div>
                                                        <div class="institution-details">
                                                            <h4>Banco Dante</h4>
                                                            <p>API Dante - Transações</p>
                                                        </div>
                                                    </div>
                                                    <div class="connection-status" id="status-dante">
                                                        <span class="status-text">Não conectado</span>
                                                    </div>
                                                </div>
                                                
                                                <div class="institution-card-settings" data-bank-id="raul">
                                                    <div class="institution-selection-checkbox">
                                                        <input type="checkbox" id="bank-raul" class="bank-checkbox">
                                                        <label for="bank-raul" class="checkbox-label"></label>
                                                    </div>
                                                    <div class="institution-info">
                                                        <div class="institution-logo raul">R</div>
                                                        <div class="institution-details">
                                                            <h4>Banco Raul</h4>
                                                            <p>API Raul - Usuários</p>
                                                        </div>
                                                    </div>
                                                    <div class="connection-status" id="status-raul">
                                                        <span class="status-text">Não conectado</span>
                                                    </div>
                                                </div>
                                                
                                                <div class="institution-card-settings" data-bank-id="caputi">
                                                    <div class="institution-selection-checkbox">
                                                        <input type="checkbox" id="bank-caputi" class="bank-checkbox">
                                                        <label for="bank-caputi" class="checkbox-label"></label>
                                                    </div>
                                                    <div class="institution-info">
                                                        <div class="institution-logo caputi">C</div>
                                                        <div class="institution-details">
                                                            <h4>Banco Caputi</h4>
                                                            <p>API Caputi - Autenticação</p>
                                                        </div>
                                                    </div>
                                                    <div class="connection-status" id="status-caputi">
                                                        <span class="status-text">Não conectado</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="multi-connect-actions">
                                                <div class="selection-info">
                                                    <span id="selectedCount">0</span> instituição(ões) selecionada(s)
                                                </div>
                                                <div class="connect-buttons">
                                                    <button type="button" class="btn btn-outline" id="selectAllBtn">
                                                        <i class="fas fa-check-double"></i>
                                                        Selecionar Todas
                                                    </button>
                                                    <button type="button" class="btn btn-primary" id="connectSelectedBtn" disabled>
                                                        <i class="fas fa-link"></i>
                                                        Conectar Selecionadas
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Separador -->
                                        <div class="section-divider"></div>
                                        
                                        <!-- Seção de Contas Conectadas (existente) -->
                                        <div class="open-finance-info">
                                            <div class="info-item">
                                                <i class="fas fa-link"></i>
                                                <div class="info-content">
                                                    <h4>Contas Conectadas</h4>
                                                    <p>Você possui <strong id="connectedCountDisplay">0 contas</strong> conectadas via Open Finance</p>
                                                </div>
                                            </div>
                                    
                                            <div class="connected-accounts">
                                                <!-- Accounts will be dynamically rendered by JavaScript -->
                                            </div>
                                
                                            <div class="form-actions">
                                                <button type="button" class="btn btn-outline" id="disconnectAccountsBtn">
                                                    <i class="fas fa-unlink"></i>
                                                    Desvincular Todas as Contas
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section content-section" id="privacy-section">
                                <div class="settings-content">
                                    <div class="section-header">
                                        <h3 class="section-title">
                                            <i class="fas fa-user-shield"></i>
                                            Privacidade
                                        </h3>
                                        <p class="section-subtitle">Controle seus dados e privacidade</p>
                                    </div>
                                    
                                    <div class="settings-card">
                                    <div class="privacy-options">
                                        <div class="privacy-item">
                                            <div class="privacy-info">
                                                <h4>Compartilhamento de Dados</h4>
                                                <p>Controle como seus dados são compartilhados com terceiros</p>
                                            </div>
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="dataSharing" checked>
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                        
                                        <div class="privacy-item">
                                            <div class="privacy-info">
                                                <h4>Notificações por E-mail</h4>
                                                <p>Receba atualizações sobre sua conta por e-mail</p>
                                            </div>
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="emailNotifications" checked>
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                        
                                        <div class="privacy-item">
                                            <div class="privacy-info">
                                                <h4>Análise de Uso</h4>
                                                <p>Ajude-nos a melhorar o app compartilhando dados de uso anônimos</p>
                                            </div>
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="usageAnalytics">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="settings-card danger-card delete-account-card">
                                    <div class="section-header">
                                        <h4 class="danger-title">
                                            <i class="fas fa-exclamation-triangle"></i>
                                            Zona de Perigo
                                        </h4>
                                        <p class="section-subtitle">Ações irreversíveis da conta</p>
                                    </div>
                                    
                                    <div class="danger-info">
                                        <h5>Deletar Conta</h5>
                                        <p>Esta ação é <strong>irreversível</strong>. Todos os seus dados, preferências e histórico serão permanentemente removidos.</p>
                                    </div>
                                    
                                    <div class="form-actions">
                                        <button type="button" class="btn btn-danger" id="deleteAccountBtn">
                                            <i class="fas fa-trash"></i>
                                            Deletar Conta
                                        </button>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="logoutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirmar Saída</h3>
                <span class="modal-close" id="closeLogoutModal">&times;</span>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja sair?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelLogoutBtn">Cancelar</button>
                <button class="btn btn-primary" id="confirmLogoutBtn">Sair</button>
            </div>
        </div>
    </div>

    <div id="disconnectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Desvincular Contas</h3>
                <span class="modal-close" id="closeDisconnectModal">&times;</span>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja desvincular todas as contas do Open Finance?</p>
                <p><strong>Esta ação irá:</strong></p>
                <ul>
                    <li>Remover todas as conexões bancárias</li>
                    <li>Interromper a sincronização automática</li>
                    <li>Você precisará reconectar manualmente</li>
                </ul>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDisconnectBtn">Cancelar</button>
                <button class="btn btn-outline" id="confirmDisconnectBtn">Desvincular</button>
            </div>
        </div>
    </div>

    <div id="disconnectSingleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Desvincular Banco</h3>
                <span class="modal-close" id="closeDisconnectSingleModal">&times;</span>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja desvincular a conta do <strong id="bankNameToDisconnect"></strong>?</p>
                <p><strong>Esta ação irá:</strong></p>
                <ul>
                    <li>Remover a conexão com este banco</li>
                    <li>Interromper a sincronização automática desta conta</li>
                    <li>Você precisará reconectar manualmente se desejar</li>
                </ul>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDisconnectSingleBtn">Cancelar</button>
                <button class="btn btn-outline" id="confirmDisconnectSingleBtn">Desvincular</button>
            </div>
        </div>
    </div>

    <div id="deleteAccountModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Deletar Conta</h3>
                <span class="modal-close" id="closeDeleteModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="warning-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h4>Atenção: Esta ação é irreversível!</h4>
                </div>
                <p>Ao deletar sua conta, os seguintes dados serão <strong>permanentemente removidos</strong>:</p>
                <ul>
                    <li>Todas as informações pessoais</li>
                    <li>Histórico de transações</li>
                    <li>Conexões bancárias</li>
                    <li>Preferências e configurações</li>
                    <li>Dados de investimentos</li>
                </ul>
                <div class="confirmation-input">
                    <label for="deleteConfirmation">Digite "DELETAR" para confirmar:</label>
                    <input type="text" id="deleteConfirmation" class="form-input" placeholder="DELETAR">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDeleteBtn">Cancelar</button>
                <button class="btn btn-danger" id="confirmDeleteBtn" disabled>Deletar Conta</button>
            </div>
        </div>
    </div>

    <script type="module">
        import SidebarComponent from '../js/components/sidebar.js';
        import HeaderComponent from '../js/components/header.js';
        import { checkAuthentication } from '../js/auth-utils.js';
        import '../js/settings.js';
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize components
            const sidebar = new SidebarComponent();
            const header = new HeaderComponent({
                pageTitle: 'Configurações',
                pageSubtitle: 'Gerencie suas preferências e conta',
                showBreadcrumb: true
            });
            
            // Render components
            sidebar.init(document.getElementById('sidebar-container'));
            header.init(document.getElementById('header-container'));
            
            // Check authentication
            checkAuthentication();
        });
    </script>
</body>
</html>